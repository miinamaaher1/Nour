@model XCourse.Core.ViewModels.StudentsViewModels.HomeViewModel



@{
    ViewData["Title"] = "Home";
}

@section Styles {
    <link rel="stylesheet" href="~/Content/tui-calendar/tui-calendar.min.css">
    <style>
        .carousel-container {
            position: relative;
            overflow: hidden;
        }

        .carousel-scroll {
            scroll-behavior: smooth;
            display: flex;
            overflow-x: auto;
            scrollbar-width: none;
            -ms-overflow-style: none;
            padding: 20px 40px;
            gap: 15px;
        }

            .carousel-scroll::-webkit-scrollbar {
                display: none;
            }

        .scroll-btn {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            z-index: 10;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

            .scroll-btn.prev {
                left: 5px;
            }

            .scroll-btn.next {
                right: 5px;
            }

        .card-item {
            min-width: 250px;
            transition: transform 0.3s;
        }

            .card-item:hover {
                transform: translateY(-5px);
            }

        .sidebar {
            border-left: 1px solid #dee2e6;
            padding-left: 15px;
        }

        .teacher-img {
            width: 70px;
            height: 70px;
            object-fit: cover;
            border: 2px solid #ddd;
        }

        .announcement-item {
            border-left: 4px solid #007bff;
            padding: 10px;
            margin-bottom: 10px;
            background-color: #f8f9fa;
        }

        .tui-calendar {
            height: 300px;
            margin-bottom: 20px;
        }

        .calendar-container {
            margin-bottom: 20px;
        }
    </style>
    }
<div class="col-12">

    <!--Calendar-->
    <div class="col-12">
        <!-- Calendar -->
        <div class="card shadow-sm mb-4">
            <div class="card-header bg-info text-white">
                <h5 class="mb-0"><i class="fas fa-calendar me-2"></i>Calendar</h5>
            </div>
            <div class="card-body">
                <div id="calendar" class="calendar-container"></div>
            </div>
        </div>
    </div>


    <!--Upcomming sessions-->
    <div class="col-12">
        <div class="card shadow-sm mb-4">
            <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
                <h4 class="mb-0"><i class="fas fa-clock me-2"></i>Upcoming Sessions</h4>
                <a asp-area="Students" asp-action="Index" asp-controller="Session" class="btn btn-light btn-sm">
                    View All <i class="fas fa-arrow-right ms-1"></i>
                </a>
            </div>
            <div class="carousel-container">
                <button class="btn btn-dark scroll-btn prev" id="prevSession"><i class="fas fa-chevron-left"></i></button>
                <div id="sessionCarousel" class="carousel-scroll">
                    @foreach (var session in Model.UpcomingSessions)
                    {
                        <div class="card shadow-sm card-item">
                            <div class="card-body text-center">
                                <div class="d-flex flex-column align-items-center mb-3">
                                    <img class="rounded-circle teacher-img mb-2"
                                         src="@(session.TeacherProfilePicture != null ? "data:image/*;base64," + Convert.ToBase64String(session.TeacherProfilePicture) : Url.Content("~/images/default_teacher.jpg"))"
                                         alt="Teacher Profile">
                                    <h5 class="text-primary fw-bold">@session.SubjectName</h5>
                                </div>
                                <p class="mb-1">
                                    <i class="fas fa-user-tie text-secondary me-2"></i>
                                    <strong>Teacher:</strong> <span class="text-secondary">@session.GroupTeacherName</span>
                                </p>
                                <p class="mb-1">
                                    <i class="fas fa-calendar-alt text-secondary me-2"></i>
                                    <strong>Date:</strong> <span class="text-secondary">@session.StartDateTime.ToString("MMM d, yyyy")</span>
                                </p>
                                <p class="mb-1">
                                    <i class="fas fa-clock text-secondary me-2"></i>
                                    <strong>Time:</strong> <span class="text-secondary">@session.StartDateTime.ToString("h:mm tt")</span>
                                </p>
                                <p class="mb-1">
                                    <i class="fas fa-hourglass-half text-secondary me-2"></i>
                                    <strong>Duration:</strong> <span class="text-secondary">@session.Duration?.ToString(@"hh\:mm")</span>
                                </p>
                                <div class="mt-3">
                                    <span class="badge bg-success p-2">
                                        <i class="fas fa-@(session.IsOnline ? "video" : "map-marker-alt") me-1"></i>
                                        @(session.IsOnline ? "Online" : "Offline")
                                    </span>
                                </div>
                            </div>
                        </div>
                    }
                </div>
                <button class="btn btn-dark scroll-btn next" id="nextSession"><i class="fas fa-chevron-right"></i></button>
            </div>
        </div>
    </div>

    <!-- Recommended Groups -->
    <div class="col-12">
        <div class="card shadow-sm">
            <div class="card-header bg-success text-white d-flex justify-content-between align-items-center">
                <h4 class="mb-0"><i class="fas fa-users me-2"></i>Recommended Groups</h4>
                <a href="#" class="btn btn-light btn-sm">
                    View All <i class="fas fa-arrow-right ms-1"></i>
                </a>
            </div>
            <div class="carousel-container">
                <button class="btn btn-dark scroll-btn prev" id="prevGroup"><i class="fas fa-chevron-left"></i></button>
                <div id="groupCarousel" class="carousel-scroll">
                    @foreach (var group in Model.RecommendedGroups)
                    {
                        <div class="card shadow-sm card-item">
                            <img class="card-img-top"
                                 src="@(group.GroupPicture != null ? "data:image/*;base64," + Convert.ToBase64String(group.GroupPicture) : Url.Content("~/images/default_Group.jpg"))"
                                 alt="Group Cover"
                                 style="height: 150px; object-fit: cover;">
                            <div class="card-body text-center">
                                <h5 class="text-success fw-bold">@group.SubjectName</h5>
                                <p class="mb-1">
                                    <i class="fas fa-user-tie text-secondary me-2"></i>
                                    <strong>Teacher:</strong> <span class="text-secondary">@group.GroupTeacherName</span>
                                </p>
                                <p class="mb-1">
                                    <i class="fas fa-tag text-secondary me-2"></i>
                                    <strong>Price:</strong> <span class="text-secondary">$@group.PricePerSession per session</span>
                                </p>
                                <p class="mb-1">
                                    <i class="fas fa-users text-secondary me-2"></i>
                                    <strong>Capacity:</strong> <span class="text-secondary">@group.CurrentStudentsCount/@group.MaxStudents</span>
                                </p>
                                <div class="mt-3 d-flex flex-wrap justify-content-center gap-2">
                                    <span class="badge bg-success">
                                        <i class="fas fa-@(group.IsOnline ? "video" : "map-marker-alt") me-1"></i>
                                        @(group.IsOnline ? "Online" : "Offline")
                                    </span>
                                    <span class="badge bg-warning text-dark">
                                        <i class="fas fa-@(group.IsGirlsOnly ? "venus" : "venus-mars") me-1"></i>
                                        @(group.IsGirlsOnly ? "Girls Only" : "Mixed Group")
                                    </span>
                                </div>
                                <a class="btn btn-outline-info" asp-area="Students" asp-controller="Group" asp-action="DetailsNotEnrolled" asp-route-id="@group.GroupID">Details</a>
                            </div>
                        </div>
                    }
                </div>
                <button class="btn btn-dark scroll-btn next" id="nextGroup"><i class="fas fa-chevron-right"></i></button>
            </div>
        </div>
    </div>

    
</div>

@section Scripts {
    <script src="@Url.Content("~/Scripts/tui-code-snippet.min.js")"></script>
    <script src="@Url.Content("~/Scripts/tui-calendar.min.js")"></script>

    <script>
        // Set up carousels
        function setupCarousel(prevBtnId, nextBtnId, containerId) {
            document.getElementById(prevBtnId).addEventListener("click", function() {
                document.getElementById(containerId).scrollBy({ left: -300, behavior: "smooth" });
            });
            document.getElementById(nextBtnId).addEventListener("click", function() {
                document.getElementById(containerId).scrollBy({ left: 300, behavior: "smooth" });
            });
        }

        // Initialize carousels
        setupCarousel("prevSession", "nextSession", "sessionCarousel");
        setupCarousel("prevGroup", "nextGroup", "groupCarousel");

        // Initialize Toast UI Calendar
        document.addEventListener('DOMContentLoaded', function() {
            // Create calendar instance
            var calendar = new tui.Calendar('#calendar', {
                defaultView: 'month',
                taskView: false,
                useDetailPopup: true,
                month: {
                    daynames: ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'],
                    startDayOfWeek: 0,
                    narrowWeekend: false
                },
                template: {
                    monthDayname: function(dayname) {
                        return '<span class="calendar-week-dayname-name">' + dayname.label + '</span>';
                    }
                }
            });


            // Today highlight
            calendar.setDate(new Date());
            calendar.render();
        });
    </script>
}